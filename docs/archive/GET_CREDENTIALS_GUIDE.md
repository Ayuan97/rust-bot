# ğŸ”‘ å¦‚ä½•è·å– FCM å‡­è¯

## âš ï¸ é‡è¦è¯´æ˜

è¦ä½¿ç”¨ Rust+ é…å¯¹åŠŸèƒ½ï¼Œ**å¿…é¡»**å…ˆè·å–å…³è”åˆ°ä½  Steam è´¦å·çš„ FCM å‡­è¯ã€‚

æ²¡æœ‰è¿™äº›å‡­è¯ï¼Œç³»ç»Ÿæ— æ³•æ¥æ”¶æ¥è‡ªæ¸¸æˆæœåŠ¡å™¨çš„é…å¯¹æ¨é€ï¼

---

## ğŸ¯ æ–¹æ³• 1: ä½¿ç”¨ rustplus CLIï¼ˆæœ€ç®€å•ï¼‰â­â­â­

è¿™æ˜¯**æœ€æ¨è**çš„æ–¹å¼ï¼

### æ­¥éª¤

```bash
# 1. å®‰è£… rustplus CLI å·¥å…·
npm install -g @liamcottle/rustplus.js

# 2. å¯åŠ¨é…å¯¹æœåŠ¡å™¨
rustplus-pairing-server

# 3. ä¼šæ˜¾ç¤ºä¸€ä¸ªäºŒç»´ç å’Œé“¾æ¥
# ç¤ºä¾‹è¾“å‡º:
#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
#   â”‚                                     â”‚
#   â”‚   â–ˆâ–€â–€â–€â–€â–€â–ˆ â–ˆâ–€â–ˆ â–€â–€â–ˆâ–€â–€â–ˆ â–ˆâ–€â–€â–€â–€â–€â–ˆ     â”‚
#   â”‚   â–ˆ â–ˆâ–ˆâ–ˆ â–ˆ â–€â–€â–ˆâ–„ â–„â–ˆ â–„â–ˆ â–ˆ â–ˆâ–ˆâ–ˆ â–ˆ     â”‚
#   â”‚   â–ˆ â–€â–€â–€ â–ˆ â–€ â–€â–ˆâ–ˆâ–ˆâ–„ â–€â–ˆ â–ˆ â–€â–€â–€ â–ˆ     â”‚
#   â”‚                                     â”‚
#   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
#
#   Or visit: http://localhost:8080
```

### åœ¨æ‰‹æœºä¸Šæ“ä½œ

#### Android / iOS:
1. æ‰“å¼€ Rust+ App
2. ç™»å½•ä½ çš„ Steam è´¦å·
3. åœ¨ App ä¸­æ‰¾åˆ°æ‰«æäºŒç»´ç çš„åŠŸèƒ½
4. æ‰«æç»ˆç«¯æ˜¾ç¤ºçš„äºŒç»´ç 
5. å®Œæˆé…å¯¹

### å®Œæˆ

å‡­è¯ä¼šè‡ªåŠ¨ä¿å­˜åˆ°ï¼š`~/.rustplus/credentials`

**é‡å¯æˆ‘ä»¬çš„é¡¹ç›®**ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å¹¶åŠ è½½è¿™ä¸ªå‡­è¯æ–‡ä»¶ï¼

```bash
# åœæ­¢ç°æœ‰è¿›ç¨‹ï¼ˆCtrl + Cï¼‰
# é‡æ–°å¯åŠ¨
./start.sh

# çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºè¡¨ç¤ºæˆåŠŸ:
# âœ… å·²ä» rustplus CLI åŠ è½½å‡­è¯
# ğŸ“‚ å‡­è¯æ¥æº: /Users/xxx/.rustplus/credentials
# âœ… FCM ç›‘å¬å·²å¯åŠ¨
```

---

## ğŸ¯ æ–¹æ³• 2: ä» Rust+ App æå–ï¼ˆAndroidï¼‰

å¦‚æœä½ å·²ç»åœ¨ç”¨ Rust+ Appï¼Œå¯ä»¥ç›´æ¥æå–å‡­è¯ã€‚

### å‰ææ¡ä»¶
- Android è®¾å¤‡
- å·²å®‰è£… Rust+ App
- å·²ç™»å½• Steam è´¦å·
- è®¾å¤‡å·² Rootï¼ˆæˆ–ä½¿ç”¨ ADB backupï¼‰

### æ­¥éª¤ 1: Root è®¾å¤‡æ–¹å¼

```bash
# è¿æ¥è®¾å¤‡
adb shell
su

# è¿›å…¥ Rust+ æ•°æ®ç›®å½•
cd /data/data/com.facepunch.rust.companion/

# æŸ¥æ‰¾å‡­è¯
cat shared_prefs/Expo.plist

# æˆ–è€…
cat shared_prefs/*.xml | grep -E "(fcm|expo|credentials)"
```

### æ­¥éª¤ 2: æå–å…³é”®ä¿¡æ¯

æŸ¥æ‰¾ä»¥ä¸‹å­—æ®µï¼š
- `expoPushToken` - FCM Token
- `credentials` - å®Œæ•´å‡­è¯ JSON

### æ­¥éª¤ 3: ä¿å­˜ä¸ºæ–‡ä»¶

å°†æå–çš„ JSON ä¿å­˜åˆ°ï¼š
```
~/.rustplus/credentials
```

æ ¼å¼ç¤ºä¾‹ï¼š
```json
{
  "fcm": {
    "token": "ExponentPushToken[xxx]",
    "pushSet": "default"
  },
  "keys": {
    "privateKey": "...",
    "publicKey": "...",
    "authSecret": "..."
  }
}
```

---

## ğŸ¯ æ–¹æ³• 3: æŠ“åŒ…è·å–

ä½¿ç”¨æŠ“åŒ…å·¥å…·è·å–å‡­è¯ã€‚

### å·¥å…·é€‰æ‹©
- mitmproxy (å…è´¹)
- Charles (ä»˜è´¹)
- Burp Suite (å…è´¹ç¤¾åŒºç‰ˆ)

### æ­¥éª¤

#### 1. é…ç½®æŠ“åŒ…ä»£ç†
```bash
# å®‰è£… mitmproxy
pip install mitmproxy

# å¯åŠ¨ä»£ç†
mitmproxy -p 8080

# æˆ–ä½¿ç”¨ Web ç•Œé¢
mitmweb -p 8080
```

#### 2. æ‰‹æœºé…ç½®ä»£ç†
- è¿æ¥åˆ°åŒä¸€ WiFi
- è®¾ç½® HTTP ä»£ç†
- ä¸»æœº: ç”µè„‘ IP
- ç«¯å£: 8080
- å®‰è£… mitmproxy è¯ä¹¦

#### 3. æ‰“å¼€ Rust+ App
ç™»å½•åï¼Œåœ¨ mitmproxy ä¸­æŸ¥æ‰¾ï¼š
```
POST https://companion-rust.facepunch.com/api/push/register
```

#### 4. æŸ¥çœ‹è¯·æ±‚å†…å®¹
```json
{
  "AuthToken": "Steam_Auth_Token_Here",
  "DeviceId": "ExponentPushToken[xxx]",
  "PushKind": 0
}
```

#### 5. æ„é€ å‡­è¯æ–‡ä»¶
æ ¹æ®æŠ“åŒ…ä¿¡æ¯æ„é€ å®Œæ•´çš„å‡­è¯ JSONã€‚

---

## ğŸ¯ æ–¹æ³• 4: é€šè¿‡ Web ç•Œé¢æ‰‹åŠ¨è¾“å…¥

å¦‚æœä½ å·²ç»é€šè¿‡å…¶ä»–æ–¹å¼è·å–äº†å‡­è¯ï¼Œå¯ä»¥ç›´æ¥åœ¨ Web ç•Œé¢è¾“å…¥ã€‚

### æ­¥éª¤

1. å¯åŠ¨é¡¹ç›®
```bash
./start.sh
```

2. è®¿é—® Web ç•Œé¢
```
http://localhost:5173
```

3. ç‚¹å‡»"è¾“å…¥ FCM å‡­è¯"

4. å¡«å†™è¡¨å•
```
FCM Token: ExponentPushToken[xxx]
æˆ–
GCM Android ID: 5052709013102372144
GCM Security Token: 8153440654009569937
Steam ID: 76561198385127796
```

5. ç‚¹å‡»"ä¿å­˜å¹¶å¼€å§‹ç›‘å¬"

---

## ğŸ“‹ å‡­è¯æ ¼å¼è¯´æ˜

### å®Œæ•´æ ¼å¼ï¼ˆæ¨èï¼‰
```json
{
  "fcm": {
    "token": "ExponentPushToken[xxxxxxxxx]",
    "pushSet": "default"
  },
  "keys": {
    "privateKey": "-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----",
    "publicKey": "-----BEGIN PUBLIC KEY-----\n...\n-----END PUBLIC KEY-----",
    "authSecret": "base64_encoded_string"
  }
}
```

### ç®€åŒ–æ ¼å¼
```json
{
  "fcm_token": "ExponentPushToken[xxx]",
  "gcm_android_id": "5052709013102372144",
  "gcm_security_token": "8153440654009569937",
  "steam_id": "76561198385127796"
}
```

---

## âœ… éªŒè¯å‡­è¯æ˜¯å¦æœ‰æ•ˆ

### é€šè¿‡ API
```bash
curl http://localhost:3000/api/pairing/status
```

å“åº”ï¼š
```json
{
  "success": true,
  "status": {
    "isListening": true,
    "hasCredentials": true,
    "hasStoredCredentials": true
  }
}
```

### é€šè¿‡æ—¥å¿—
å¯åŠ¨é¡¹ç›®åæŸ¥çœ‹æ—¥å¿—ï¼š
```
âœ… æ‰¾åˆ°å·²ä¿å­˜çš„ FCM å‡­è¯
âœ… FCM å‡­è¯å·²åŠ è½½
ğŸ‘‚ å¼€å§‹ç›‘å¬ FCM æ¨é€æ¶ˆæ¯...
âœ… FCM ç›‘å¬å·²å¯åŠ¨
```

---

## ğŸš¨ å¸¸è§é—®é¢˜

### Q1: ä½¿ç”¨æ–¹æ³• 3ï¼ˆ/api/pairing/startï¼‰å¯ä»¥å—ï¼Ÿ

**ä¸æ¨èï¼**

è™½ç„¶ä¼šç”Ÿæˆ FCM å‡­è¯ï¼Œä½†ï¼š
- âŒ æ²¡æœ‰å…³è” Steam è´¦å·
- âŒ æ¸¸æˆæœåŠ¡å™¨ä¸çŸ¥é“æ¨é€ç»™è°
- âŒ æ— æ³•æ¥æ”¶é…å¯¹æ¨é€
- âŒ é…å¯¹åŠŸèƒ½æ— æ³•ä½¿ç”¨

### Q2: å‡­è¯ä¼šè¿‡æœŸå—ï¼Ÿ

Steam Auth Token ä¼šåœ¨ **2 å‘¨**åè¿‡æœŸã€‚

ä½† FCM å‡­è¯ç†è®ºä¸Šä¸ä¼šè¿‡æœŸã€‚å¦‚æœå¤±æ•ˆï¼š
1. é‡æ–°ä½¿ç”¨ rustplus CLI è·å–
2. æˆ–è€…æ‰‹åŠ¨åˆ·æ–° Steam Auth Token

### Q3: å¤šä¸ªè®¾å¤‡å¯ä»¥å…±ç”¨å‡­è¯å—ï¼Ÿ

ç†è®ºä¸Šå¯ä»¥ï¼Œä½†**ä¸æ¨è**ï¼š
- å¯èƒ½å¯¼è‡´æ¨é€æ··ä¹±
- åªæœ‰ä¸€ä¸ªè®¾å¤‡èƒ½æ¥æ”¶æ¨é€
- å»ºè®®æ¯ä¸ªè®¾å¤‡ä½¿ç”¨ç‹¬ç«‹å‡­è¯

### Q4: æˆ‘æ²¡æœ‰ Android è®¾å¤‡æ€ä¹ˆåŠï¼Ÿ

**æ–¹æ³• 1ï¼ˆæ¨èï¼‰**: ä½¿ç”¨ Android æ¨¡æ‹Ÿå™¨
```bash
# å®‰è£… Android Studio
# åˆ›å»ºè™šæ‹Ÿè®¾å¤‡
# å®‰è£… Rust+ APK
# ä½¿ç”¨ rustplus CLI é…å¯¹
```

**æ–¹æ³• 2**: å€Ÿç”¨æœ‹å‹çš„ Android è®¾å¤‡
- ä¸´æ—¶ç™»å½•ä½ çš„ Steam
- ä½¿ç”¨ rustplus CLI é…å¯¹
- å‡­è¯ä¿å­˜åå°±å¯ä»¥å½’è¿˜è®¾å¤‡

**æ–¹æ³• 3**: ä½¿ç”¨ iOS
- iOS ç‰ˆæœ¬ä¹Ÿå¯ä»¥é…å¯¹
- ä½†æå–å‡­è¯æ›´å›°éš¾ï¼ˆéœ€è¦è¶Šç‹±ï¼‰
- æ¨èä½¿ç”¨ rustplus CLI æ–¹å¼

---

## ğŸ’¡ æ¨èæµç¨‹

### é¦–æ¬¡ä½¿ç”¨

```bash
# 1. å®‰è£… rustplus CLI
npm install -g @liamcottle/rustplus.js

# 2. è·å–å‡­è¯
rustplus-pairing-server
# åœ¨æ‰‹æœº App ä¸­æ‰«æäºŒç»´ç 

# 3. å¯åŠ¨æˆ‘ä»¬çš„é¡¹ç›®
cd rust-bot-new
./start.sh

# 4. ç³»ç»Ÿè‡ªåŠ¨åŠ è½½å‡­è¯
# âœ… å·²ä» rustplus CLI åŠ è½½å‡­è¯
```

### ä¹‹åä½¿ç”¨

```bash
# ç›´æ¥å¯åŠ¨ï¼Œè‡ªåŠ¨åŠ è½½å·²ä¿å­˜çš„å‡­è¯
./start.sh
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [rustplus.js GitHub](https://github.com/liamcottle/rustplus.js)
- [Rust+ Pairing Flow](https://github.com/liamcottle/rustplus.js/blob/master/docs/PairingFlow.md)
- [Rust Companion API](https://companion-rust.facepunch.com)

---

**æœ€åæ›´æ–°**: 2025-10-18

**æ¨èæ–¹æ³•**: ğŸ¥‡ rustplus CLI â†’ ğŸ¥ˆ ä» App æå– â†’ ğŸ¥‰ æŠ“åŒ…
