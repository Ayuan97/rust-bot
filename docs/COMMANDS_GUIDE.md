# 游戏内命令系统指南

本文档说明如何在游戏中通过队伍聊天与 Rust+ 机器人进行互动。

## 快速开始

在游戏内打开队伍聊天（默认按 `Enter` 键），输入以 `!` 开头的命令即可与机器人互动。

**示例：**
```
!time
!help
!online
```

机器人会自动识别命令并在队伍聊天中回复结果。

---

## 可用命令列表

### 基础命令

| 命令 | 说明 | 示例输出 |
|------|------|----------|
| `!help` | 显示所有可用命令 | `可用命令: help, time, pop, team...` |
| `!time` | 显示游戏时间和距离天亮/天黑的真实时间 | `当前游戏时间为 14:23 距离天黑在 45 分钟后` |
| `!pop` | 显示服务器人数和30分钟内变化趋势 | `当前在线人数为 127/200 最近半小时+15` |

### 队伍命令

| 命令 | 说明 | 示例输出 |
|------|------|----------|
| `!team` | 显示队伍统计（在线/离线/挂机人数） | `团队总人数(5) 在线(3) 离线(2)` |
| `!online` | 显示在线队友列表 | `队伍 3/5 在线 张三, 李四, 王五` |
| `!afk` | 显示挂机队友及挂机时长 | `挂机(2) 张三(15分钟), 李四(8分钟)` |
| `!leader [名字]` | 移交队长权限给指定队友 | `已将队长移交给 张三` |

### 事件查询命令

| 命令 | 说明 | 示例输出 |
|------|------|----------|
| `!cargo` | 查询货船当前位置和状态 | `货船位于 M15-3 还有 12 分钟即将离开` |
| `!heli` | 查询武装直升机状态 | `武装直升机位于 J8-7` |
| `!small` | 查询小油井触发状态和箱子解锁倒计时 | `小油井已触发 (5分钟前) 箱子还有 10 分钟解锁` |
| `!large` | 查询大油井触发状态和箱子解锁倒计时 | `大油井 8 分钟前触发 箱子已解锁` |
| `!events` | 查看所有当前活跃的游戏事件 | `当前活跃事件: 货船 M15, 武装直升机 J8` |
| `!history` | 查看所有事件的历史记录 | `事件历史: 货船刷新: 10分钟前...` |

### 历史记录命令

| 命令 | 说明 | 示例输出 |
|------|------|----------|
| `!smalllast` | 查看上次小油井触发时间 | `小油井上次触发: 25分钟前` |
| `!largelast` | 查看上次大油井触发时间 | `大油井上次触发: 1小时前` |
| `!helilast` | 查看上次武装直升机事件时间 | `武装直升机最近一次活动: 45分钟前` |

### 实用命令

| 命令 | 说明 | 示例输出 |
|------|------|----------|
| `!shop [物品]` | 搜索售货机中的物品，显示位置和价格 | `找到 3 个 硫磺: M15-3 500x硫磺...` |

---

## 详细命令说明

### `!time` - 游戏时间

显示当前游戏时间，以及距离日出或日落的真实分钟数。

**用法：**
```
!time
```

**示例输出：**
```
# 白天时
当前游戏时间为 14:23 距离天黑在 45 分钟后

# 夜晚时
当前游戏时间为 22:15 距离天亮在 32 分钟后
```

---

### `!pop` - 服务器人数

显示当前在线人数、最大人数，以及最近30分钟的人数变化趋势。

**用法：**
```
!pop
```

**示例输出：**
```
# 有变化时
当前在线人数为 127/200 最近半小时+15

# 无明显变化时
当前在线人数为 127/200

# 有排队时
当前在线人数为 200/200 排队人数 23
```

---

### `!team` - 队伍状态

显示队伍的整体状态统计，包括在线/离线人数和挂机情况。

**用法：**
```
!team
```

**示例输出：**
```
团队总人数(5) 在线(3) 离线(2)
挂机人员(1人) 张三(挂机15分钟)
```

---

### `!leader [名字]` - 移交队长

将队长权限移交给指定的队友。

**用法：**
```
!leader 张三
```

**示例输出：**
```
# 成功时
已将队长移交给 张三

# 已经是队长
张三 已经是队长了

# 找不到玩家
找不到玩家: 张三

# 当前账号不是队长
移交失败: 当前账号不是队长
```

---

### `!shop [物品]` - 售货机搜索

搜索地图上所有售货机中的指定物品，显示位置和价格。

**用法：**
```
!shop 硫磺
!shop rocket
```

**示例输出：**
```
# 搜索到结果
找到 3 个 硫磺:
发射场(M15-3) 500x硫磺 售价: 200x废金属
港口(J8-7) 1000x硫磺 售价: 500x废金属

# 没有找到
没有找到 火箭

# 不带参数（显示售货机总数）
地图上共有 45 个售货机
```

---

### `!cargo` - 货船状态

查询货船的当前位置和剩余时间。

**用法：**
```
!cargo
```

**示例输出：**
```
# 货船在地图上
货船位于 M15-3 还有 12 分钟即将离开

# 货船活跃中（无计时器）
货船位于 J8-7

# 没有货船
当前地图上没有货船
```

---

### `!small` / `!large` - 油井状态

查询小油井或大油井的触发状态和箱子解锁倒计时。

**用法：**
```
!small    # 小油井
!large    # 大油井
```

**示例输出：**
```
# 刚触发，箱子未解锁
小油井已触发 (5分钟前) 箱子还有 10 分钟解锁

# 箱子已解锁
大油井 8 分钟前触发 箱子已解锁

# 较早触发
小油井上次触发: 45 分钟前

# 未触发
大油井尚未被触发
```

---

### `!events` - 活跃事件

查看当前所有活跃的游戏事件。

**用法：**
```
!events
```

**示例输出：**
```
当前活跃事件:
货船 M15-3 (12分钟后离开)
武装直升机 J8-7
CH47 2架
上锁箱子 3个
小油井箱子 5分钟后解锁
```

---

## 主动通知功能

机器人会自动监控游戏事件并在队伍聊天中发送通知，无需手动输入命令。

### 队友动态

| 事件 | 通知内容 |
|------|----------|
| 上线 | `` `张三` 在离线 2小时30分钟 后上线了`` |
| 下线 | `` `张三` 今天游玩了 3小时 (其中挂机 45分钟)`` |
| 死亡 | `` `张三` 在 发射场(M15-3) 死亡`` |
| 挂机 | `` `张三` 已离开 5 分钟 - K12-7`` |
| 回来 | `` `张三` 在 8分钟 后回来了`` |

### 游戏事件

| 事件 | 通知内容 |
|------|----------|
| 货船刷新 | `目前货船位于 右上 M15-3` |
| 货船停靠 | `货船已停靠港口 L8-5` |
| 货船辐射 | `货船离开港口 辐射快速上升 赶紧撤离！` |
| 货船离开 | `货船已离开地图` |
| 直升机刷新 | `武装直升机已刷新在 G14-2` |
| 直升机击落 | `武装直升机被击落 位置: J11-4` |
| 油井触发 | `小油井已触发 重型科学家正在赶来` |
| 油井箱子 | `小油井箱子还有 5 分钟解锁` |
| 上锁箱子 | `上锁箱子出现 位置: 发射场(H16-8)` |
| CH47 | `CH47已出现 位置: N9-6` |

### 安全警报

| 事件 | 通知内容 |
|------|----------|
| 袭击检测 | `检测到袭击 位置: J11-4 (3次爆炸)` |
| 售货机监控 | `新售货机出现 位置: M15-3 共12件商品 重要物品: 火箭` |

---

## 坐标系统

所有位置信息都使用精确的子网格坐标系统：

### 坐标格式

- **网格坐标**: `M15` - 标准 Rust 地图网格
- **子网格**: `M15-3` - 精确到 3×3 子区域（1-9）
- **古迹识别**: `发射场(M15-3)` - 在古迹范围内自动显示中文名称

### 子网格布局

```
┌───┬───┬───┐
│ 7 │ 8 │ 9 │  ← 上方（北）
├───┼───┼───┤
│ 4 │ 5 │ 6 │  ← 中间
├───┼───┼───┤
│ 1 │ 2 │ 3 │  ← 下方（南）
└───┴───┴───┘
```

**示例**: `M15-5` 表示 M15 网格的中心位置

详细说明请参考 [坐标系统文档](COORDINATES.md)

---

## 注意事项

1. **命令前缀**: 所有命令都以 `!` 开头
2. **大小写**: 命令不区分大小写（`!TIME` 和 `!time` 效果相同）
3. **权限**: 所有队伍成员都可以使用命令
4. **频率限制**: 避免频繁发送命令，可能会触发 API 限流
5. **消息长度**: 队伍聊天有长度限制，过长的回复可能被截断

---

## 相关文档

- [事件系统指南](./EVENTS_GUIDE.md) - 了解所有可用的事件类型
- [坐标系统文档](./COORDINATES.md) - 坐标转换详细说明
- [API 文档](./API_CHANNELS.md) - Rust+ API 详细说明
- [架构文档](./ARCHITECTURE.md) - 系统架构说明

---

**最后更新**: 2025-12-14
