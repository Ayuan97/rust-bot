# æ¸¸æˆå†…å‘½ä»¤ç³»ç»ŸæŒ‡å—

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•åœ¨æ¸¸æˆä¸­é€šè¿‡é˜Ÿä¼èŠå¤©ä¸ Rust+ æœºå™¨äººè¿›è¡Œäº’åŠ¨ã€‚

## ğŸ® å¿«é€Ÿå¼€å§‹

åœ¨æ¸¸æˆå†…æ‰“å¼€é˜Ÿä¼èŠå¤©ï¼ˆé»˜è®¤æŒ‰ `Enter` é”®ï¼‰ï¼Œè¾“å…¥ä»¥ `!` å¼€å¤´çš„å‘½ä»¤å³å¯ä¸æœºå™¨äººäº’åŠ¨ã€‚

**ç¤ºä¾‹ï¼š**
```
!time
!help
!online
```

æœºå™¨äººä¼šè‡ªåŠ¨è¯†åˆ«å‘½ä»¤å¹¶åœ¨é˜Ÿä¼èŠå¤©ä¸­å›å¤ç»“æœã€‚

---

## ğŸ“‹ å¯ç”¨å‘½ä»¤

### åŸºç¡€å‘½ä»¤

#### `!help`
æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤åˆ—è¡¨ã€‚

**ç”¨æ³•ï¼š**
```
!help
```

**ç¤ºä¾‹è¾“å‡ºï¼š**
```
ğŸ“‹ å¯ç”¨å‘½ä»¤:
!help - æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤
!time - æ˜¾ç¤ºå½“å‰æ¸¸æˆæ—¶é—´
!info - æ˜¾ç¤ºæœåŠ¡å™¨ä¿¡æ¯
!online - æ˜¾ç¤ºåœ¨çº¿é˜Ÿå‹
!ping - æµ‹è¯•æœºå™¨äººå“åº”
!pos - æ˜¾ç¤ºæ‰€æœ‰é˜Ÿå‹ä½ç½®
!markers - æ˜¾ç¤ºåœ°å›¾æ ‡è®°æ•°é‡
!notify - æ§åˆ¶è‡ªåŠ¨é€šçŸ¥ï¼ˆæ­»äº¡/é‡ç”Ÿï¼‰
!stats - æ˜¾ç¤ºé˜Ÿä¼ç»Ÿè®¡
```

---

#### `!ping`
æµ‹è¯•æœºå™¨äººæ˜¯å¦æ­£å¸¸è¿è¡Œã€‚

**ç”¨æ³•ï¼š**
```
!ping
```

**ç¤ºä¾‹è¾“å‡ºï¼š**
```
ğŸ“ Pong! æœºå™¨äººè¿è¡Œæ­£å¸¸
```

---

### æ—¶é—´ä¸æœåŠ¡å™¨ä¿¡æ¯

#### `!time` â­ æ¨è
æ˜¾ç¤ºå½“å‰æ¸¸æˆå†…æ—¶é—´ï¼ŒåŒ…æ‹¬æ—¥å‡ºæ—¥è½æ—¶é—´ã€‚

**ç”¨æ³•ï¼š**
```
!time
```

**ç¤ºä¾‹è¾“å‡ºï¼š**
```
â˜€ï¸ æ¸¸æˆæ—¶é—´: 14:23
ğŸŒ… æ—¥å‡º: 06:30
ğŸŒ‡ æ—¥è½: 18:45
```

---

#### `!info`
æ˜¾ç¤ºæœåŠ¡å™¨è¯¦ç»†ä¿¡æ¯ã€‚

**ç”¨æ³•ï¼š**
```
!info
```

**ç¤ºä¾‹è¾“å‡ºï¼š**
```
ğŸ–¥ï¸ æœåŠ¡å™¨: [EU] Awesome Server
ğŸ—ºï¸ åœ°å›¾: Procedural Map (3500m)
ğŸ‘¥ åœ¨çº¿äººæ•°: 87/150
â³ æ’é˜Ÿ: 5
```

---

### é˜Ÿä¼ç›¸å…³å‘½ä»¤

#### `!online` â­ æ¨è
æ˜¾ç¤ºæ‰€æœ‰é˜Ÿä¼æˆå‘˜çš„åœ¨çº¿çŠ¶æ€ã€‚

**ç”¨æ³•ï¼š**
```
!online
```

**ç¤ºä¾‹è¾“å‡ºï¼š**
```
ğŸ‘¥ é˜Ÿä¼æˆå‘˜ (3/5 åœ¨çº¿):

ğŸŸ¢ åœ¨çº¿:
  â€¢ PlayerOne âœ… å­˜æ´»
  â€¢ PlayerTwo ğŸ’€ å·²æ­»äº¡
  â€¢ PlayerThree âœ… å­˜æ´»

ğŸ”´ ç¦»çº¿:
  â€¢ PlayerFour
  â€¢ PlayerFive
```

---

#### `!pos`
æ˜¾ç¤ºæ‰€æœ‰åœ¨çº¿é˜Ÿå‹çš„åœ°å›¾åæ ‡ã€‚

**ç”¨æ³•ï¼š**
```
!pos
```

**ç¤ºä¾‹è¾“å‡ºï¼š**
```
ğŸ“ é˜Ÿå‹ä½ç½®:
  âœ… PlayerOne: (1250, 2340)
  ğŸ’€ PlayerTwo: (980, 1560)
  âœ… PlayerThree: (1305, 2298)
```

---

### åœ°å›¾ç›¸å…³å‘½ä»¤

#### `!markers`
æ˜¾ç¤ºåœ°å›¾ä¸Šçš„æ ‡è®°ç»Ÿè®¡ã€‚

**ç”¨æ³•ï¼š**
```
!markers
```

**ç¤ºä¾‹è¾“å‡ºï¼š**
```
ğŸ“ åœ°å›¾æ ‡è®° (å…± 15 ä¸ª):
  â€¢ ç©å®¶: 5
  â€¢ å”®è´§æœº: 7
  â€¢ ç©ºæŠ•: 2
  â€¢ å·¡é€»ç›´å‡æœº: 1
```

---

### è®¾ç½®å‘½ä»¤

#### `!notify` â­ æ–°å¢
æ§åˆ¶è‡ªåŠ¨é€šçŸ¥åŠŸèƒ½çš„å¼€å…³ï¼ˆæ­»äº¡é€šçŸ¥ã€é‡ç”Ÿé€šçŸ¥ï¼‰ã€‚

**ç”¨æ³•ï¼š**
```
!notify                  # æŸ¥çœ‹å½“å‰è®¾ç½®
!notify death on         # å¼€å¯æ­»äº¡é€šçŸ¥
!notify death off        # å…³é—­æ­»äº¡é€šçŸ¥
!notify spawn on         # å¼€å¯é‡ç”Ÿé€šçŸ¥
!notify spawn off        # å…³é—­é‡ç”Ÿé€šçŸ¥
```

**ç¤ºä¾‹è¾“å‡ºï¼š**
```
# æŸ¥çœ‹è®¾ç½®
ğŸ”” é€šçŸ¥è®¾ç½®:
  ğŸ’€ æ­»äº¡é€šçŸ¥: å¼€å¯
  âœ¨ é‡ç”Ÿé€šçŸ¥: å¼€å¯

ç”¨æ³•: !notify [death|spawn] [on|off]

# ä¿®æ”¹è®¾ç½®
ğŸ’€ æ­»äº¡é€šçŸ¥å·²å…³é—­
```

**è¯´æ˜ï¼š**
- æ­»äº¡é€šçŸ¥é»˜è®¤å¼€å¯ï¼Œå½“é˜Ÿå‹æ­»äº¡æ—¶è‡ªåŠ¨åœ¨é˜Ÿä¼èŠå¤©å‘é€ä½ç½®
- é‡ç”Ÿé€šçŸ¥é»˜è®¤å¼€å¯ï¼Œå½“é˜Ÿå‹é‡ç”Ÿæ—¶è‡ªåŠ¨å‘é€é€šçŸ¥
- æ¯ä¸ªæœåŠ¡å™¨çš„è®¾ç½®ç‹¬ç«‹ä¿å­˜

---

### ç»Ÿè®¡å‘½ä»¤

#### `!stats`
æ˜¾ç¤ºé˜Ÿä¼ç»Ÿè®¡ä¿¡æ¯ï¼ˆå¼€å‘ä¸­ï¼‰ã€‚

**ç”¨æ³•ï¼š**
```
!stats
```

**ç¤ºä¾‹è¾“å‡ºï¼š**
```
ğŸ“Š ç»Ÿè®¡åŠŸèƒ½å¼€å‘ä¸­...
```

---

## ğŸ”§ è‡ªå®šä¹‰å‘½ä»¤

å¼€å‘è€…å¯ä»¥é€šè¿‡ç¼–ç¨‹æ–¹å¼æ·»åŠ è‡ªå®šä¹‰å‘½ä»¤ã€‚

### æ³¨å†Œè‡ªå®šä¹‰å‘½ä»¤

åœ¨ `/backend/src/app.js` æˆ–ä»»ä½•åˆå§‹åŒ–ä»£ç ä¸­ï¼š

```javascript
import rustPlusService from './services/rustplus.service.js';

// è·å–å‘½ä»¤æœåŠ¡
const commandsService = rustPlusService.getCommandsService();

// æ³¨å†Œè‡ªå®šä¹‰å‘½ä»¤
commandsService.registerCommand('greet', {
  description: 'å‘é˜Ÿä¼é—®å¥½',
  usage: '!greet [åå­—]',
  handler: async (serverId, args, context) => {
    const name = args[0] || context.name;
    return `ğŸ‘‹ ä½ å¥½, ${name}! æ¬¢è¿ä½¿ç”¨æœºå™¨äººï¼`;
  }
});

// æ³¨å†Œå¸¦å‚æ•°çš„å‘½ä»¤
commandsService.registerCommand('remind', {
  description: 'è®¾ç½®æé†’',
  usage: '!remind <æ—¶é—´(ç§’)> <æ¶ˆæ¯>',
  handler: async (serverId, args, context) => {
    if (args.length < 2) {
      return 'âŒ ç”¨æ³•: !remind <æ—¶é—´(ç§’)> <æ¶ˆæ¯>';
    }

    const seconds = parseInt(args[0]);
    if (isNaN(seconds) || seconds <= 0) {
      return 'âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„ç§’æ•°';
    }

    const message = args.slice(1).join(' ');
    
    setTimeout(async () => {
      await rustPlusService.sendTeamMessage(
        serverId,
        `â° æé†’ @${context.name}: ${message}`
      );
    }, seconds * 1000);

    return `âœ… å°†åœ¨ ${seconds} ç§’åæé†’ä½ : ${message}`;
  }
});
```

### å‘½ä»¤é…ç½®é€‰é¡¹

```javascript
{
  description: string,    // å‘½ä»¤æè¿°ï¼ˆå¿…éœ€ï¼‰
  usage: string,         // ä½¿ç”¨æ–¹æ³•ï¼ˆå¯é€‰ï¼Œé»˜è®¤ !commandNameï¼‰
  handler: function,     // å¤„ç†å‡½æ•°ï¼ˆå¿…éœ€ï¼‰
  adminOnly: boolean     // æ˜¯å¦ä»…ç®¡ç†å‘˜å¯ç”¨ï¼ˆå¯é€‰ï¼Œé»˜è®¤ falseï¼‰
}
```

### Handler å‡½æ•°å‚æ•°

```javascript
async function handler(serverId, args, context) {
  // serverId: æœåŠ¡å™¨ ID
  // args: å‘½ä»¤å‚æ•°æ•°ç»„ï¼Œä¾‹å¦‚ "!cmd arg1 arg2" -> ['arg1', 'arg2']
  // context: {
  //   name: string,      // å‘é€è€…åç§°
  //   steamId: string,   // å‘é€è€… Steam ID
  //   message: string    // å®Œæ•´æ¶ˆæ¯å†…å®¹
  // }
  
  // è¿”å›å­—ç¬¦ä¸²å°†ä½œä¸ºå›å¤å‘é€åˆ°é˜Ÿä¼èŠå¤©
  // è¿”å› null/undefined åˆ™ä¸å‘é€å›å¤
  return 'å›å¤æ¶ˆæ¯';
}
```

---

## ğŸ’¡ é«˜çº§ç¤ºä¾‹

### 1. æ­»äº¡é€šçŸ¥å‘½ä»¤

```javascript
let deathNotifications = new Map(); // serverId -> enabled

commandsService.registerCommand('deathnotify', {
  description: 'å¼€å…³æ­»äº¡é€šçŸ¥',
  usage: '!deathnotify [on|off]',
  handler: async (serverId, args, context) => {
    const action = args[0]?.toLowerCase();
    
    if (action === 'on') {
      deathNotifications.set(serverId, true);
      return 'âœ… å·²å¼€å¯æ­»äº¡é€šçŸ¥';
    } else if (action === 'off') {
      deathNotifications.set(serverId, false);
      return 'âœ… å·²å…³é—­æ­»äº¡é€šçŸ¥';
    } else {
      const enabled = deathNotifications.get(serverId);
      return `â„¹ï¸ æ­»äº¡é€šçŸ¥å½“å‰: ${enabled ? 'å¼€å¯' : 'å…³é—­'}`;
    }
  }
});

// ç›‘å¬æ­»äº¡äº‹ä»¶
rustPlusService.on('player:died', async (data) => {
  if (deathNotifications.get(data.serverId)) {
    await rustPlusService.sendTeamMessage(
      data.serverId,
      `ğŸ’€ ${data.name} åœ¨ (${Math.round(data.x)}, ${Math.round(data.y)}) æ­»äº¡äº†ï¼`
    );
  }
});
```

### 2. è®¾å¤‡çŠ¶æ€æŸ¥è¯¢å‘½ä»¤

```javascript
commandsService.registerCommand('device', {
  description: 'æŸ¥è¯¢è®¾å¤‡çŠ¶æ€',
  usage: '!device <è®¾å¤‡ID>',
  handler: async (serverId, args, context) => {
    if (args.length === 0) {
      return 'âŒ ç”¨æ³•: !device <è®¾å¤‡ID>';
    }

    const entityId = parseInt(args[0]);
    if (isNaN(entityId)) {
      return 'âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„è®¾å¤‡ID';
    }

    try {
      const info = await rustPlusService.getEntityInfo(serverId, entityId);
      const status = info.payload.value ? 'ğŸŸ¢ å¼€å¯' : 'ğŸ”´ å…³é—­';
      const type = info.type === 1 ? 'å¼€å…³' : 
                   info.type === 2 ? 'è­¦æŠ¥' : 
                   info.type === 3 ? 'å‚¨ç‰©ç›‘è§†å™¨' : 'æœªçŸ¥';
      
      return `ğŸ›ï¸ è®¾å¤‡ ${entityId} (${type})\nçŠ¶æ€: ${status}`;
    } catch (error) {
      return `âŒ æŸ¥è¯¢å¤±è´¥: ${error.message}`;
    }
  }
});
```

### 3. é˜Ÿä¼å¬é›†å‘½ä»¤

```javascript
commandsService.registerCommand('gather', {
  description: 'å¬é›†é˜Ÿå‹åˆ°æŒ‡å®šä½ç½®',
  usage: '!gather <X> <Y>',
  handler: async (serverId, args, context) => {
    if (args.length < 2) {
      return 'âŒ ç”¨æ³•: !gather <X> <Y>';
    }

    const x = parseInt(args[0]);
    const y = parseInt(args[1]);

    if (isNaN(x) || isNaN(y)) {
      return 'âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„åæ ‡';
    }

    return `ğŸ“ ${context.name} å¬é›†å¤§å®¶åˆ° (${x}, ${y})ï¼\næ‰€æœ‰äººé›†åˆï¼`;
  }
});
```

---

## ğŸš€ å®ç°åŸç†

### æ¶ˆæ¯å¤„ç†æµç¨‹

1. **æ¥æ”¶æ¶ˆæ¯** - Rust+ API æ¥æ”¶åˆ°é˜Ÿä¼èŠå¤©æ¶ˆæ¯
2. **æ£€æµ‹å‘½ä»¤** - æ£€æŸ¥æ¶ˆæ¯æ˜¯å¦ä»¥ `!` å¼€å¤´
3. **è§£æå‘½ä»¤** - æå–å‘½ä»¤åå’Œå‚æ•°
4. **æŸ¥æ‰¾å¤„ç†å™¨** - åœ¨å·²æ³¨å†Œçš„å‘½ä»¤ä¸­æŸ¥æ‰¾å¯¹åº”å¤„ç†å™¨
5. **æ‰§è¡Œå‘½ä»¤** - è°ƒç”¨å¤„ç†å™¨å‡½æ•°
6. **å‘é€å“åº”** - å°†ç»“æœå‘é€å›é˜Ÿä¼èŠå¤©

### ä»£ç ä½ç½®

- **å‘½ä»¤æœåŠ¡**: `/backend/src/services/commands.service.js`
- **é›†æˆé€»è¾‘**: `/backend/src/services/rustplus.service.js`
- **äº‹ä»¶è½¬å‘**: `/backend/src/services/websocket.service.js`

---

## ğŸ“Š å‘½ä»¤ç»Ÿè®¡ä¸æ—¥å¿—

æ‰€æœ‰å‘½ä»¤æ‰§è¡Œéƒ½ä¼šåœ¨åç«¯æ§åˆ¶å°è¾“å‡ºæ—¥å¿—ï¼š

```
ğŸ® æ”¶åˆ°å‘½ä»¤: !time (æ¥è‡ª PlayerOne)
âœ… å‘½ä»¤æ‰§è¡ŒæˆåŠŸ: !time
```

å¦‚æœå‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œä¹Ÿä¼šæœ‰ç›¸åº”çš„é”™è¯¯æ—¥å¿—ï¼š

```
âŒ å‘½ä»¤æ‰§è¡Œå¤±è´¥ !time: æœåŠ¡å™¨æœªè¿æ¥
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æƒé™æ§åˆ¶**: å½“å‰æ‰€æœ‰é˜Ÿä¼æˆå‘˜éƒ½å¯ä»¥ä½¿ç”¨å‘½ä»¤ã€‚å¦‚éœ€é™åˆ¶ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥ `context.steamId` å®ç°ã€‚

2. **é¢‘ç‡é™åˆ¶**: Rust+ API æœ‰é€Ÿç‡é™åˆ¶ï¼Œè¿‡äºé¢‘ç¹å‘é€æ¶ˆæ¯å¯èƒ½å¯¼è‡´è¢«é™æµã€‚å»ºè®®åœ¨å‘½ä»¤å¤„ç†ä¸­åŠ å…¥å†·å´æ—¶é—´ã€‚

3. **é”™è¯¯å¤„ç†**: æ‰€æœ‰å‘½ä»¤éƒ½åº”è¯¥æœ‰é€‚å½“çš„é”™è¯¯å¤„ç†ï¼Œé¿å…å‘½ä»¤å¤±è´¥å¯¼è‡´æœºå™¨äººå´©æºƒã€‚

4. **æ¶ˆæ¯é•¿åº¦**: é˜Ÿä¼èŠå¤©æ¶ˆæ¯æœ‰é•¿åº¦é™åˆ¶ï¼Œè¿‡é•¿çš„å›å¤å¯èƒ½è¢«æˆªæ–­ã€‚

5. **å¼‚æ­¥æ‰§è¡Œ**: å‘½ä»¤æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œä¸ä¼šé˜»å¡å…¶ä»–æ¶ˆæ¯å¤„ç†ã€‚

---

## ğŸ”® æœªæ¥è®¡åˆ’

- [ ] å‘½ä»¤æƒé™ç³»ç»Ÿï¼ˆç®¡ç†å‘˜å‘½ä»¤ï¼‰
- [ ] å‘½ä»¤å†·å´æ—¶é—´
- [ ] å‘½ä»¤åˆ«åæ”¯æŒ
- [ ] æŒä¹…åŒ–ç»Ÿè®¡æ•°æ®
- [ ] æ›´å¤šå†…ç½®å‘½ä»¤
- [ ] å‘½ä»¤ä½¿ç”¨ç»Ÿè®¡
- [ ] å¤šè¯­è¨€æ”¯æŒ

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤æ–°çš„å‘½ä»¤æƒ³æ³•æˆ–æ”¹è¿›å»ºè®®ï¼å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ï¼š

1. åœ¨é¡¹ç›®ä¸­æ·»åŠ è‡ªå®šä¹‰å‘½ä»¤
2. æäº¤ Pull Request è´¡çŒ®å†…ç½®å‘½ä»¤
3. æŠ¥å‘Š Bug æˆ–æå‡ºåŠŸèƒ½è¯·æ±‚

---

## ç›¸å…³æ–‡æ¡£

- [äº‹ä»¶ç³»ç»ŸæŒ‡å—](./EVENTS_GUIDE.md) - äº†è§£æ‰€æœ‰å¯ç”¨çš„äº‹ä»¶ç±»å‹
- [API æ–‡æ¡£](./API_CHANNELS.md) - Rust+ API è¯¦ç»†è¯´æ˜
- [æ¶æ„æ–‡æ¡£](./ARCHITECTURE.md) - ç³»ç»Ÿæ¶æ„è¯´æ˜

