# Rust+ Web Dashboard

一个基于 Web 的 Rust+ 游戏助手，无需打开游戏即可监控服务器、与队友聊天、控制智能设备。

## 功能特性

- **服务器监控** - 实时查看服务器状态、在线玩家、游戏时间
- **队伍聊天** - 从网页发送消息到游戏内队伍聊天
- **智能设备控制** - 远程控制游戏内的门、灯、开关等设备
- **游戏事件追踪** - 货船、直升机、空投、油井等事件实时提醒
- **队友动态** - 自动通知队友上下线、死亡、挂机状态
- **游戏内命令** - 通过队伍聊天发送 `!` 命令与机器人互动
- **精准定位** - 子网格坐标(M15-3)、古迹自动识别(发射场)
- **售货机搜索** - 搜索地图上所有售货机的物品
- **袭击检测** - 检测爆炸声并发出警报

---

## 快速开始

### Docker 部署（推荐）

**前置要求：** Docker >= 20.10, Docker Compose >= 2.0

```bash
# 一键启动
./docker-start.sh

# 或手动启动
docker-compose up -d

# 查看日志
docker-compose logs -f
```

**访问地址：**
- 前端：http://localhost:3002
- 后端：http://localhost:3001/api

**修改端口：** 编辑 `.env` 文件中的 `BACKEND_PORT` 和 `FRONTEND_PORT`

详细说明见 [Docker 部署指南](DOCKER.md)

---

### 本地部署

**前置要求：** Node.js >= 16

```bash
# 1. 安装后端依赖
cd backend && npm install

# 2. 安装前端依赖
cd ../frontend && npm install

# 3. 启动后端（终端1）
cd backend && npm start

# 4. 启动前端（终端2）
cd frontend && npm run dev
```

**访问地址：**
- 前端：http://localhost:5173
- 后端：http://localhost:3000

---

## 首次使用

### 第一步：获取凭证

1. 打开网页后，点击「开始配对」
2. 点击「自动注册」，会打开 Steam 登录页面
3. 使用 Steam 账号登录
4. 登录成功后，页面会显示凭证命令：
   ```
   /credentials add gcm_android_id:xxx gcm_security_token:xxx steam_id:xxx ...
   ```
5. 复制完整命令，粘贴到输入框
6. 点击「完成注册」，等待连接建立

### 第二步：配对服务器

1. 确保网页显示「FCM 已连接」
2. 进入 Rust 游戏，加入服务器
3. 按 ESC → 点击右下角 Rust+ 图标 → 点击「Pair with Server」
4. 网页会自动显示配对成功通知
5. 服务器出现在列表中，点击即可连接

---

## 游戏内命令

连接服务器后，在游戏内队伍聊天中输入命令即可使用：

### 基础命令

| 命令 | 说明 |
|------|------|
| `!help` | 显示所有可用命令 |
| `!time` | 查看游戏时间，显示距离天亮/天黑的真实分钟数 |
| `!pop` | 查看服务器人数和30分钟内变化趋势 |

### 队伍命令

| 命令 | 说明 |
|------|------|
| `!team` | 显示队伍统计（在线/离线/挂机人数） |
| `!online` | 显示在线队友列表 |
| `!afk` | 显示挂机队友及挂机时长 |
| `!leader [名字]` | 移交队长权限给指定队友 |

### 事件命令

| 命令 | 说明 |
|------|------|
| `!cargo` | 查看货船位置和剩余时间 |
| `!heli` | 查看武装直升机位置 |
| `!small` | 查看小油井状态和箱子解锁倒计时 |
| `!large` | 查看大油井状态和箱子解锁倒计时 |
| `!events` | 查看所有活跃事件 |
| `!history` | 查看事件历史记录 |

### 实用命令

| 命令 | 说明 |
|------|------|
| `!shop [物品]` | 搜索售货机中的物品，显示位置和价格 |
| `!smalllast` | 查看上次小油井触发时间 |
| `!largelast` | 查看上次大油井触发时间 |
| `!helilast` | 查看上次直升机事件时间 |

完整说明见 [命令指南](docs/COMMANDS_GUIDE.md)

---

## 自动通知

机器人会自动在队伍聊天发送以下通知：

### 队友动态
- **上线通知** - `张三 在离线 2小时30分钟 后上线了`
- **下线通知** - `张三 今天游玩了 3小时 (其中挂机 45分钟)`
- **死亡通知** - `张三 在 发射场(M15-3) 死亡`
- **挂机提醒** - `张三 已离开 5 分钟 - K12-7`

### 游戏事件
- **货船** - 刷新、停靠、辐射上升、离开
- **直升机** - 刷新、被击落、离开
- **油井** - 触发、箱子解锁倒计时
- **上锁箱子** - 出现位置
- **CH47** - 出现和离开

### 安全警报
- **袭击检测** - `检测到袭击 位置: J11-4 (3次爆炸)`

---

## 常见问题

### 收不到推送消息？

1. 检查后端日志是否显示「FCM 连接已建立」
2. 检查是否有心跳日志（每30秒一次）
3. 凭证可能过期，重新获取凭证

### 凭证过期了？

重新访问 https://companion-rust.facepunch.com/login 登录获取新凭证。凭证有效期约2周。

### 配对失败？

1. 确保 FCM 已连接（网页显示绿色状态）
2. 在游戏中重新点击「Pair with Server」
3. 检查后端日志查看错误信息

### 设备无法控制？

1. 确保设备已在游戏中配对（按住 E → Pair）
2. 检查设备是否有电源
3. 刷新设备列表

---

## 安全提醒

- FCM 凭证可以接收你的游戏推送，不要分享给他人
- 凭证存储在本地服务器，不会上传
- 建议在私有网络中部署

---

## 相关文档

- [Docker 部署指南](DOCKER.md)
- [命令使用指南](docs/COMMANDS_GUIDE.md)
- [代理配置（中国大陆）](docs/PROXY_SETUP.md)

---

## 致谢

- [@liamcottle/rustplus.js](https://github.com/liamcottle/rustplus.js) - Rust+ API 库
- [Facepunch Studios](https://rust.facepunch.com/) - Rust 游戏开发商

---

**版本:** 2.1.0 | **更新日期:** 2025-12-14
